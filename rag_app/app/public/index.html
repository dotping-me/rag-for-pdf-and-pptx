<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>This won't be seen so don't bother</title>
</head>

<body>
    <form name="someForm">
        <input type="file" name="inputForRAG" id="inputForRAG">
        <input type="submit" value="Load">

        <p id="feedback"></p>
    </form>

    <script defer>
        
        // API layer ready
        window.addEventListener("pywebviewready", async (initialLoadEvent) => {
            let someForm = document.forms.someForm;
            let feedback = document.getElementById("feedback");

            someForm.addEventListener("submit", async(e) => {
                e.preventDefault();
                
                // 1. Validate uploaded file

                // 1.1 Must upload file
                const fileInput = someForm.inputForRAG;
                if (!fileInput.files || fileInput.files.length === 0) {
                    feedback.innerText = "Please upload a file!"
                    return;
                }

                // 1.2 Validate file type
                const file = fileInput.files[0];

                // 2. Convert uploaded file into bytes to send to backend
                try {
                    const bytes = new Uint8Array(await file.arrayBuffer());
                    const fname = file.name;

                    let res = await window.pywebview.api.api_rag_load_doc(
                        { name: fname, bytes: Array.from(bytes) }
                    );

                    res = JSON.parse(res);
                    console.log(res);

                } catch(err) {
                    console.log(err);
                }

                // 3. Reset the form
                someForm.reset();
            });
        });

    </script>
</body>
</html>